temuco_map <- ggmap::get_googlemap(location = "Temuco", zoom = 7)
map <- get_map()
map
str(map)
ggmap(map)
map <- get_map()
epsoc4_geo %>%
filter(region == 2) %>%
ggplot() +
geom_sf()
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(colour = survyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(colour = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(fill = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4 %>%
select(folio, sbj.num, region, srvyr, latitude, longitude)
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 13) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf, ggmap,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc4 <-haven::read_spss(paste0(path, '181122 - EPSOC Base parcial 5.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc4) <- tolower(gsub("_", ".", names(epsoc4)))
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc4 <- makeVlist(epsoc4)
labs.epsoc4 <- labs.epsoc4 %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc4)
epsoc4 %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
homologar_fechas <- function(fecha){
fecha %>%
str_replace_all(c("^\\D{3} " = "", '(.*)(\\d{4}$)' = '\\2 \\1')) %>%
anytime::anytime()
}
epsoc4 <- epsoc4 %>%
mutate_at(vars(starts_with('time')), homologar_fechas)
epsoc4 <- epsoc4 %>%
mutate(duration = str_replace_all(duration, c('-' = '', '^(\\d{2})' = '0\\.\\1'))) %>%
separate(duration, into = c('dura.d', 'duracion'), sep = '\\.', convert = TRUE, remove = FALSE) %>%
mutate(duracion.t = as.duration(hms(duracion) + hms(hms::hms(hour = (24 * dura.d)))))
epsoc4$duracion.t.min <- epsoc4$duracion.t@.Data/60
epsoc4 %>%
ggplot(aes(x = duracion.t.min)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ggtitle("Distribución duración entrevistas por región (escala truncada < 150 minutos)") +
labs(x = "Duración total entrevista (minutos)",
y = "Frecuencia") +
coord_cartesian(xlim = 0:150) +
scale_x_continuous(breaks = seq(0, 150, by = 15)) +
facet_grid(as_factor(region) ~ .)
epsoc4 %>%
filter(as.double(duracion.t.min) < 20) %>%
select(folio, duracion.t.min) %>%
knitr::kable(col.names = c("Folio", "Duración (minutos)"),
caption = "Entrevistas de menos de 20 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
filter(as.double(duracion.t.min) > 150) %>%
transmute(folio, duracion.t.min / 60) %>%
knitr::kable(col.names = c("Folio", "Duración (horas)"),
caption = "Entrevistas de más de 150 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
select(folio, latitude, srvyr) %>%
group_by(srvyr) %>%
mutate(n.enc = length(folio)) %>%
filter(is.na(latitude)) %>%
select(folio, srvyr, n.enc) %>%
mutate(n.enc.sg = (length(folio)/n.enc)*100) %>%
arrange(srvyr, folio) %>%
group_by_at(vars(-folio)) %>%
nest() %>%
mutate(Folio = map_chr(data, ~ flatten(.) %>% str_c(., collapse = ', '))) %>%
select(-data) %>%
kable(digits = 1,
col.names = c("Encuestador", "Total encuestas", "% sin georef.", "folios")) %>%
kable_estilo()
epsoc4_geo <- epsoc4 %>%
select(folio, sbj.num, region, srvyr, latitude, longitude) %>%
filter(!is.na(latitude)) %>%
sf::st_as_sf(coords = c('latitude', 'longitude'),
crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf, ggmap,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc4 <-haven::read_spss(paste0(path, '181122 - EPSOC Base parcial 5.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc4) <- tolower(gsub("_", ".", names(epsoc4)))
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc4 <- makeVlist(epsoc4)
labs.epsoc4 <- labs.epsoc4 %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc4)
epsoc4 %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
homologar_fechas <- function(fecha){
fecha %>%
str_replace_all(c("^\\D{3} " = "", '(.*)(\\d{4}$)' = '\\2 \\1')) %>%
anytime::anytime()
}
epsoc4 <- epsoc4 %>%
mutate_at(vars(starts_with('time')), homologar_fechas)
epsoc4 <- epsoc4 %>%
mutate(duration = str_replace_all(duration, c('-' = '', '^(\\d{2})' = '0\\.\\1'))) %>%
separate(duration, into = c('dura.d', 'duracion'), sep = '\\.', convert = TRUE, remove = FALSE) %>%
mutate(duracion.t = as.duration(hms(duracion) + hms(hms::hms(hour = (24 * dura.d)))))
epsoc4$duracion.t.min <- epsoc4$duracion.t@.Data/60
epsoc4 %>%
ggplot(aes(x = duracion.t.min)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ggtitle("Distribución duración entrevistas por región (escala truncada < 150 minutos)") +
labs(x = "Duración total entrevista (minutos)",
y = "Frecuencia") +
coord_cartesian(xlim = 0:150) +
scale_x_continuous(breaks = seq(0, 150, by = 15)) +
facet_grid(as_factor(region) ~ .)
epsoc4 %>%
filter(as.double(duracion.t.min) < 20) %>%
select(folio, duracion.t.min) %>%
knitr::kable(col.names = c("Folio", "Duración (minutos)"),
caption = "Entrevistas de menos de 20 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
filter(as.double(duracion.t.min) > 150) %>%
transmute(folio, duracion.t.min / 60) %>%
knitr::kable(col.names = c("Folio", "Duración (horas)"),
caption = "Entrevistas de más de 150 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
select(folio, latitude, srvyr) %>%
group_by(srvyr) %>%
mutate(n.enc = length(folio)) %>%
filter(is.na(latitude)) %>%
select(folio, srvyr, n.enc) %>%
mutate(n.enc.sg = (length(folio)/n.enc)*100) %>%
arrange(srvyr, folio) %>%
group_by_at(vars(-folio)) %>%
nest() %>%
mutate(Folio = map_chr(data, ~ flatten(.) %>% str_c(., collapse = ', '))) %>%
select(-data) %>%
kable(digits = 1,
col.names = c("Encuestador", "Total encuestas", "% sin georef.", "folios")) %>%
kable_estilo()
epsoc4_geo <- epsoc4 %>%
select(folio, sbj.num, region, srvyr, latitude, longitude) %>%
filter(!is.na(latitude)) %>%
sf::st_as_sf(coords = c('latitude', 'longitude'),
crs = "+proj=longlat +ellps=WGS84 +datum=WGS84")
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
nc_map <- get_map(location = "North Carolina, NC", zoom = 7)
epsoc4_geo %>%
filter(region == 2) %>%
qmplot(aes(color = srvyr)) +
geom_sf()
ggmap_credentials()
ggmap::ggmap_credentials()
register_google(key = "[your key here]", account_type = "premium", day_limit = 100000)
ggmap::register_google(key = "[your key here]", account_type = "premium", day_limit = 100000)
ggmap:::register_google(key = "[your key here]", account_type = "premium", day_limit = 100000)
register_google(key = "[your key here]", account_type = "premium", day_limit = 100000)
get_googlemap("waco texas", zoom = 12) %>% ggmap()
?register_google()
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = ggspacial::world)
install.packages("ggspatial")
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = ggspatial::world)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
library(ggspatial)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
ggplot(data = world) +
geom_sf()
library("ggspatial")
ggplot(data = world) +
geom_sf()
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = rworldmap::world)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = maps::world)
library(maps)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = maps::world)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
map('world', fill = TRUE, col = 1:10)
data("world")
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
library(mapdata)
library(mapdata)
library(maps)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
usa <- map_data("usa")
world <- map_data("world")
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_sf(data = world)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_map(data = world)
world
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_map(data = world, aes(map = world))
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
geom_map(map = world)
library(ggmap)
temuco <- get_openstreetmap("world")
osm <- get_openstreetmap(urlonly = TRUE)
ggmap(osm)
gc <- geocode('new york, usa')
center <- as.numeric(gc)
ggmap(get_googlemap(center = center, color = 'bw', scale = 4), fullpage = T)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
northseamap3 <- get_map(location = c( lon = mean(d$lon), lat = mean(d$lat)),source="stamen", color="bw", zoom=6, maptype="toner")
epsoc4_geo$longitude
epsoc4_geo
mean(epsoc4_geo$geometry)
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
northseamap3 <- get_map(location = c( lon = mean(-32), lat = mean(72)),source="stamen", color="bw", zoom=6, maptype="toner")
northseamap3
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
northseamap3 <- get_map(location = c( lon = mean(-32), lat = mean(72)),source="stamen", color="bw", zoom=6, maptype="toner")
write_sf(epsoc4_geo,
dsn = here::here('output',
'EPSOC_2016_puntos_respuesta.kml'),
dataset_options=c("NameField=folio"),
delete_dsn=TRUE)
sf::write_sf(epsoc4_geo,
here::here('output',
'EPSOC_2016_puntos_respuesta.kml'),
dataset_options=c("NameField=folio"),
delete_dsn=TRUE)
sf::write_sf(epsoc4_geo,
here::here('EPSOC_2018_puntos_respuesta.kml'),
dataset_options=c("NameField=folio"),
delete_dsn=TRUE)
epsoc4_geo <- epsoc4 %>%
select(folio, sbj.num, region, srvyr, latitude, longitude) %>%
filter(!is.na(latitude)) %>%
sf::st_as_sf(coords = c('latitude', 'longitude'),
crs = "+proj=longlat +ellps=GRS80")
sf::write_sf(epsoc4_geo,
here::here('validacion_epsoc_puntos_respuesta.kml'),
dataset_options=c("NameField=folio"),
delete_dsn=TRUE)
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc4 <-haven::read_spss(paste0(path, '181122 - EPSOC Base parcial 5.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc4) <- tolower(gsub("_", ".", names(epsoc4)))
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc4 <- makeVlist(epsoc4)
labs.epsoc4 <- labs.epsoc4 %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc4)
epsoc4 %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
homologar_fechas <- function(fecha){
fecha %>%
str_replace_all(c("^\\D{3} " = "", '(.*)(\\d{4}$)' = '\\2 \\1')) %>%
anytime::anytime()
}
epsoc4 <- epsoc4 %>%
mutate_at(vars(starts_with('time')), homologar_fechas)
epsoc4 <- epsoc4 %>%
mutate(duration = str_replace_all(duration, c('-' = '', '^(\\d{2})' = '0\\.\\1'))) %>%
separate(duration, into = c('dura.d', 'duracion'), sep = '\\.', convert = TRUE, remove = FALSE) %>%
mutate(duracion.t = as.duration(hms(duracion) + hms(hms::hms(hour = (24 * dura.d)))))
epsoc4$duracion.t.min <- epsoc4$duracion.t@.Data/60
epsoc4 %>%
ggplot(aes(x = duracion.t.min)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ggtitle("Distribución duración entrevistas por región (escala truncada < 150 minutos)") +
labs(x = "Duración total entrevista (minutos)",
y = "Frecuencia") +
coord_cartesian(xlim = 0:150) +
scale_x_continuous(breaks = seq(0, 150, by = 15)) +
facet_grid(as_factor(region) ~ .)
epsoc4 %>%
filter(as.double(duracion.t.min) < 20) %>%
select(folio, duracion.t.min) %>%
knitr::kable(col.names = c("Folio", "Duración (minutos)"),
caption = "Entrevistas de menos de 20 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
filter(as.double(duracion.t.min) > 150) %>%
transmute(folio, duracion.t.min / 60) %>%
knitr::kable(col.names = c("Folio", "Duración (horas)"),
caption = "Entrevistas de más de 150 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc4 %>%
select(folio, latitude, srvyr) %>%
group_by(srvyr) %>%
mutate(n.enc = length(folio)) %>%
filter(is.na(latitude)) %>%
select(folio, srvyr, n.enc) %>%
mutate(n.enc.sg = (length(folio)/n.enc)*100) %>%
arrange(srvyr, folio) %>%
group_by_at(vars(-folio)) %>%
nest() %>%
mutate(Folio = map_chr(data, ~ flatten(.) %>% str_c(., collapse = ', '))) %>%
select(-data) %>%
kable(digits = 1,
col.names = c("Encuestador", "Total encuestas", "% sin georef.", "folios")) %>%
kable_estilo()
epsoc4_geo <- epsoc4 %>%
select(folio, sbj.num, region, srvyr, latitude, longitude) %>%
filter(!is.na(latitude)) %>%
sf::st_as_sf(coords = c('latitude', 'longitude'),
crs = "+proj=longlat +ellps=GRS80")
sf::write_sf(epsoc4_geo,
here::here('validacion_epsoc_b_puntos_respuesta.kml'),
dataset_options=c("NameField=folio"),
delete_dsn=TRUE)
epsoc4_geo %>%
filter(region == 2) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
epsoc4_geo %>%
filter(region == 13) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf() +
epsoc4_geo %>%
filter(region == 13) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo
epsoc4_geo %>%
filter(region == 9) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
epsoc4_geo %>%
filter(region == 13) %>%
ggplot(aes(color = srvyr)) +
geom_sf()
