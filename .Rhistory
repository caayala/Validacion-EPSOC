kable_estilo() #%>%
#column_spec(1, width = "10em") %>%
#column_spec(2, width = "10em") %>%
#column_spec(3, width = "10em")
flat_table(epsoc, num.grupo.jd, region, margin = 'col')
var_rec_justa <- find_var(epsoc, pattern = stringr::regex('obrero|pdte'), search = 'label')
var_rec_justa$var.label %>%
str_replace_all(c('Quisiéramos saber cuánto dinero cree Ud. que ganan las personas al mes en estos trabajos u ocupaciones que se mencionan más adelante, después de considerar los descuentos de salud, previsión u otros impuestos' = 'cuánto dinero cree Ud. que ganan',
'Pensando en lo que Ud. cree que las personas en estos trabajos deberían ganar al mes, después de los descuentos de salud, previsión u otros impuestos. ' = '')) %>%
paste0(var_rec_justa$var.name, " - ", sort(rep(seq(6), 4)), " - ", .)
epsoc %>%
arrange(num.grupo.jd, time1) %>%
select(one_of(var_rec_justa$var.name)) %>%
naniar::vis_miss()
item_just$var.name
item_just <- find_var(epsoc, "usto")
item_just$var.name
v <- validator(j := var_group(as_name(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(as_name(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(as.symbol(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
as.symbol(item_just$var.name)
sym(item_just$var.name)
syms(item_just$var.name)
v <- validator(j := var_group(syms(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
item_just <- find_var(epsoc, "usto")
syms(item_just$var.name)
v <- validator(j := var_group(syms(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
expr(item_just$var.name)
as.name(item_just$var.name)
map(item_just$var.name, as.name)
v <- validator(j := var_group(map(item_just$var.name, as.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just
v <- validator(j := var_group(i.6.a1),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
str(v)
(v)
v
str(v)
expression(i.6.a1)
expression('i.6.a1')
v <- validator(j := var_group(expression('i.6.a1')),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(!!!item_just$var.name),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
!!!item_just$var.name
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(sym(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
sym(item_just$var.name)
var_group(i.6.a1	)
var_group(i.6.a1)
var_group(i.6.a1)
syms(item_just$var.name)
expr(item_just$var.name)
rlang::parse_exprs(item_just$var.name)
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(rlang::parse_exprs(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
v <- validator(j := var_group(!!!rlang::parse_exprs(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(!!!rlang::parse_exprs(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(!!rlang::parse_exprs(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(rlang::parse_expr(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just <- find_var(epsoc, "usto")
v <- validator(j := var_group(rlang::parse_syms(item_just$var.name)),
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
rlang::parse_syms(item_just$var.name)
rlang::parse_expr(item_just$var.name)
rlang::parse_exprs(item_just$var.name)
rlang::parse_exprs(item_just$var.name) %>% flatten()
item_just <- find_var(epsoc, "usto")
rlang::parse_syms(item_just$var.name)
item_just <- find_var(epsoc, "usto")
v <- validator(j := item_just$var.name,
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just <- find_var(epsoc, "usto")
v <- validator(j := !!item_just$var.name,
j >= 1,
j <= 9,
j != 6,
j != 7)
str(v)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
item_just
item_just$var.name
item_just <- find_var(epsoc, "usto")
item_just$var.name
v <- validator(j := var_group(i.6.a1, i.8.a1, i.9.a1, i.10.a1, i.11.a1, i.12.a1, i.13.a1, i.16.a1,
i.1.h1, i.2.h1, i.5.h1, i.7.h1, i.8.h1, i.10.h1, i.11.h1, i.12.h1, i.14.h1),
j >= 1,
j <= 9,
j != 6,
j != 7)
cf2 <- confront(epsoc, v)
s.cf2 <- summary(cf2)
knitr::kable(s.cf2) %>%
kable_estilo()
epsoc %>%
arrange(num.grupo.jd, time1) %>%
select(one_of(var_rec_justa$var.name)) %>%
naniar::vis_miss() +
labs(title = 'fff')
epsoc %>%
arrange(num.grupo.jd, time1) %>%
select(one_of(var_rec_justa$var.name)) %>%
naniar::vis_miss() +
labs(title = 'Distribución de respuestas en preguntas de recompensa justa')
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here, naniar,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc <-haven::read_spss(paste0(path, '190116 - EPSOC Base parcial 12c.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc) <- tolower(gsub("_", ".", names(epsoc)))
grabacion <- FALSE
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc <- makeVlist(epsoc)
labs.epsoc <- labs.epsoc %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc)
epsoc %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
homologar_fechas <- function(fecha){
fecha %>%
str_replace_all(c("^\\D{3} " = "", '(.*)(\\d{4}$)' = '\\2 \\1')) %>%
anytime::anytime()
}
epsoc <- epsoc %>%
mutate_at(vars(starts_with('time')), homologar_fechas)
epsoc <- epsoc %>%
mutate(duration = str_replace_all(duration, c('-' = '', '^(\\d{2})' = '0\\.\\1'))) %>%
separate(duration, into = c('dura.d', 'duracion'), sep = '\\.', convert = TRUE, remove = FALSE) %>%
mutate(duracion.t = as.duration(hms(duracion) + hms(hms::hms(hour = (24 * dura.d)))))
epsoc$duracion.t.min <- epsoc$duracion.t@.Data/60
epsoc %>%
ggplot(aes(x = duracion.t.min)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ggtitle("Distribución duración entrevistas por región (escala truncada < 150 minutos)") +
labs(x = "Duración total entrevista (minutos)",
y = "Frecuencia") +
coord_cartesian(xlim = 0:150) +
scale_x_continuous(breaks = seq(0, 150, by = 15)) +
facet_grid(as_factor(region) ~ .)
epsoc %>%
filter(as.double(duracion.t.min) < 20) %>%
select(folio, duracion.t.min) %>%
knitr::kable(col.names = c("Folio", "Duración (minutos)"),
caption = "Entrevistas de menos de 20 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc %>%
filter(as.double(duracion.t.min) > 150) %>%
transmute(folio, duracion.t.min / 60) %>%
knitr::kable(col.names = c("Folio", "Duración (horas)"),
caption = "Entrevistas de más de 150 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
## Comienzo encuesta
epsoc$time1.hms <- hms::as.hms(epsoc$time1)
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc <- makeVlist(epsoc)
labs.epsoc <- labs.epsoc %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc)
epsoc %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
homologar_fechas <- function(fecha){
fecha %>%
str_replace_all(c("^\\D{3} " = "", '(.*)(\\d{4}$)' = '\\2 \\1')) %>%
anytime::anytime()
}
epsoc <- epsoc %>%
mutate_at(vars(starts_with('time')), homologar_fechas)
epsoc <- epsoc %>%
mutate(duration = str_replace_all(duration, c('-' = '', '^(\\d{2})' = '0\\.\\1'))) %>%
separate(duration, into = c('dura.d', 'duracion'), sep = '\\.', convert = TRUE, remove = FALSE) %>%
mutate(duracion.t = as.duration(hms(duracion) + hms(hms::hms(hour = (24 * dura.d)))))
epsoc$duracion.t.min <- epsoc$duracion.t@.Data/60
epsoc %>%
ggplot(aes(x = duracion.t.min)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ggtitle("Distribución duración entrevistas por región (escala truncada < 150 minutos)") +
labs(x = "Duración total entrevista (minutos)",
y = "Frecuencia") +
coord_cartesian(xlim = 0:150) +
scale_x_continuous(breaks = seq(0, 150, by = 15)) +
facet_grid(as_factor(region) ~ .)
epsoc %>%
filter(as.double(duracion.t.min) < 20) %>%
select(folio, duracion.t.min) %>%
knitr::kable(col.names = c("Folio", "Duración (minutos)"),
caption = "Entrevistas de menos de 20 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
epsoc %>%
filter(as.double(duracion.t.min) > 150) %>%
transmute(folio, duracion.t.min / 60) %>%
knitr::kable(col.names = c("Folio", "Duración (horas)"),
caption = "Entrevistas de más de 150 minutos",
digits = 1) %>%
kable_estilo() %>%
column_spec(1, width = "10em") %>%
column_spec(2, width = "10em")
## Comienzo encuesta
epsoc$time1.hms <- hms::as.hms(epsoc$time1)
## Comienzo encuesta
epsoc$time1.hms <- hms::as.hms(epsoc$time1)
epsoc$time1
epsoc$time1
names(epsoc)
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here, naniar,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc <-haven::read_spss(paste0(path, '190117 - EPSOC Base parcial 13.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc) <- tolower(gsub("_", ".", names(epsoc)))
grabacion <- FALSE
epsoc %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
pacman::p_load(tidyverse, lubridate, anytime, chron,
haven, sf,
sjlabelled, sjmisc,
validate, eeptools, kableExtra, janitor, here, naniar,
captioner)
if(Sys.info()[["user"]] == 'caayala'){
path <- "/Users/caayala/Dropbox (DESUC)/DESUC/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
} else if(Sys.info()[["user"]] == 'Andres') {
path <- "/Users/Andres/Dropbox (DESUC)/Proyectos/3 Políticas Públicas/EPSOC 2018/BD/"
}
epsoc <-haven::read_spss(paste0(path, '190117 - EPSOC Base parcial 13.sav')) %>%
clean_names() %>%
mutate(region = folio %/% 100000)
names(epsoc) <- tolower(gsub("_", ".", names(epsoc)))
grabacion <- FALSE
kable_estilo <- function(tabla){
tabla %>%
kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width=F)
}
makeVlist <- function(dta) {
labels <- sapply(dta, function(x) attr(x, "label"))
tibble(name = names(labels),
label = labels)
}  ## Etiquetas variables
labs.epsoc <- makeVlist(epsoc)
labs.epsoc <- labs.epsoc %>%
mutate(label2 = map_chr(label, toString))
labs.epsoc <- get_label(epsoc)
epsoc %>%
count(region, status) %>%
spread(status, n) %>%
janitor::adorn_totals(where = c('row', 'col')) %>%
kable() %>%
kable_estilo()
names(epsoc)
epsoc %>%
count(edad.seleccionado, edad.seleccionado, situacion.laboral.seleccionado)
epsoc %>%
count(sexo.seleccionado, edad.seleccionado, situacion.laboral.seleccionado)
names(epsoc)
epsoc %>%
count(sexo.seleccionado, enc.edad, situacion.laboral.seleccionado)
epsoc %>%
count(sexo.seleccionado, edad.seleccionado, situacion.laboral.seleccionado)
names(epsoc)
glimpse(epsoc)
epsoc %>%
transmute(rango_edad = rec(edad.seleccionado,
rec = "1:17 = 1;
18:24 = 2;
25:44 = 3;
45:59 = 4"))
epsoc <- epsoc %>%
mutate(rango_edad = rec(edad.seleccionado,
rec = "1:17 = 1;
18:24 = 2;
25:44 = 3;
45:59 = 4"))
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
kable()
frq(epsoc, rango_edad)
epsoc <- epsoc %>%
mutate(rango_edad = rec(edad.seleccionado,
rec = "1:17 =  1[menor de 18 años];
18:24 = 2[18 a 24 años];
25:44 = 3[25 a 44 años];
45:59 = 4[45 a 59 años]"))
frq(epsoc, rango_edad)
epsoc %>%
filter(is.na(rango_edad)) %>%
select(sexo.seleccionado, edad.seleccionado, situacion.laboral.seleccionado)
epsoc %>%
filter(is.na(rango_edad)) %>%
select(sexo.seleccionado, edad.seleccionado, situacion.laboral.seleccionado)
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
kable()
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
mutate_all(as_label) %>%
kable()
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
mutate_all(as_label) %>%
mutate(prop = n/sum(n)) %>%
kable()
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
mutate_all(as_label) %>%
mutate(prop = round(n/sum(n), 4)) %>%
kable()
epsoc %>%
transmute(rango_edad = replace(rango_edad, edad.seleccionado %in% c(60, 61), 4)) %>%
frq()
epsoc <- epsoc %>%
mutate(rango_edad = replace(rango_edad, edad.seleccionado %in% c(60, 61), 4))
epsoc %>%
count(sexo.seleccionado, rango_edad, situacion.laboral.seleccionado) %>%
mutate_all(as_label) %>%
mutate(prop = round(n/sum(n), 4)) %>%
kable()
CRANsearcher:::CRANsearcher()
install.packages(c("pdftools", "prabclus", "RcppArmadillo"))
